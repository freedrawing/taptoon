# 📌 Elasticsearch 클러스터링 적용기

## 목차
* []()

## 개요
현재는 Elasticsearch가 하나의 노드로만 구동되고 있다. 하지만 실제 운영 환경에서는 하나의 노드가 종료될 가능성이 있다. 단일 노드로 운영할 경우 장애가 발생하면 데이터 접근이 불가능해지는 단점이 있다. 따라서, 고가용성과 확장성을 확보하기 위해 Elasticsearch 클러스터링을 적용할 필요가 있다.

## 클러스터링이 필요한 이유
Elasticsearch는 분산 검색 엔진으로, 다수의 노드를 하나의 클러스터로 구성할 수 있다. 클러스터링을 적용하면 다음과 같은 이점을 얻을 수 있다:

1. 고가용성(High Availability): 한 노드가 다운되더라도 다른 노드가 데이터를 유지하므로 서비스 중단을 방지할 수 있다.
2. 수평 확장(Scalability): 데이터가 증가할수록 노드를 추가하여 처리 성능을 확장할 수 있다.
3. 부하 분산(Load Balancing): 검색 및 색인 작업을 여러 노드에 분산시켜 성능을 최적화할 수 있다.

## Elasticsearch 클러스터 구성
Elasticsearch 클러스터를 구성하기 위해 몇 가지 핵심 개념을 이해하고 설정해야 한다.

## 마스터 노드와 데이터 노드
Elasticsearch는 역할별로 노드를 구분하여 클러스터를 구성한다.

* 마스터 노드(Master Node): 클러스터 상태를 관리하고, 노드 추가 및 삭제를 조정하는 역할을 한다. 
* 데이터 노드(Data Node): 실제 데이터를 저장하고, 검색 및 색인 작업을 수행한다. 
* 코디네이팅 노드(Coordinating Node): 쿼리를 받아 적절한 데이터 노드에 요청을 분배하는 역할을 한다.


클러스터링 구성 예시
<img width="1200" alt="Image" src="https://github.com/user-attachments/assets/81fba3dc-b225-4809-9325-c58a36efacd1"/>

운영 환경에서는 마스터 노드를 최소 3개 이상 두어 장애에 대비하는 것이 일반적이다. 

TMI) Elasticsearch 7.x 에서는 여러 개 노드에서 노드가 한 개로 줄어들면 해당 노드가 마스터 노드가 될 수 있었지만, 8.x 버전부터는 최소한 2개의 노드가 있어야 마스터 노드 선정이 가능하다고 한다.... 

## 샤딩과 레플리카
Elasticsearch는 데이터를 샤드(Shard) 단위로 나누어 저장하며, 각 샤드는 특정 노드에 할당된다.

* 기본 샤드(Primary Shard): 데이터를 저장하는 기본 단위 
* 레플리카 샤드(Replica Shard): 기본 샤드의 복제본으로, 데이터 손실을 방지하고 부하를 분산하는 역할

샤드 개수는 인덱스 생성 시 설정할 수 있으며, 기본적으로 5개의 기본 샤드와 1개의 레플리카 샤드가 설정된다.

샤딩과 레플리카 예시 (총 3개의 노드에 각각 하나의 샤드씩 저장하고, 추가적으로 1개의 레플리카가 3개 샤드로 나뉘어 보관되고 있다)
<img width="1200" alt="Image" src="https://github.com/user-attachments/assets/81fba3dc-b225-4809-9325-c58a36efacd1" />



## Localhost에서 테스트

## 실제 운영 환경(?)에서 테스트
