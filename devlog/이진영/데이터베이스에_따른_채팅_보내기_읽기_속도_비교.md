# 데이터베이스에 따른 채팅 보내기 및 읽기 속도 비교

## 1. 테스트 개요

**목적**: MongoDB와 MySQL 기반 채팅 시스템의 쓰기(메시지 전송)와 읽기(채팅방 입장) 성능을 비교, 부하 증가에 따른 성능 변화를 분석.

**환경:**
- **서버**: Spring Boot, 로컬 (localhost:8080).
- **데이터베이스**: MongoDB (로컬, 복합 인덱스 `chat_room_id: 1, created_at: -1` 적용), MySQL (로컬).
- **도구**: JMeter (단일 JWT 토큰, senderId=1).

**시나리오:**

### 채팅 보내기 (쓰기): `/api/chats/room1/message` (POST)
- **200×3 (5초)**: 200명, 사용자당 3회, 총 600건.
- **1000×3 (10초)**: 1000명, 사용자당 3회, 총 3000건.
- **10,000×3 (60초)**: 10,000명, 사용자당 3회, 총 30,000건.

### 채팅방 입장 (읽기): `/api/chats/room1/messages` (GET, 메시지 1000개)
- **200×2 (5초)**: 200명, 사용자당 2회, 총 400건.
- **1000×2 (10초)**: 1000명, 사용자당 2회, 총 2000건.
- **10,000×2 (100초)**: 10,000명, 사용자당 2회, 총 20,000건.

---

## 2. 테스트 결과

### 2.1. 채팅 보내기 (쓰기)

#### MongoDB
| 시나리오 | Samples | Average (ms) | Throughput (req/sec) | Error % | 비고 |
|-----------|---------|--------------|----------------------|---------|-------|
| 200 × 3 (5초) | 600 | 17.87 | 119.52 | 0.00% | 안정적 처리 |
| 1000 × 3 (10초) | 3000 | 23.24 | 298.75 | 0.00% | 빠른 처리 유지 |
| 10,000 × 3 (60초) | 30,000 | 6059.38 | 342.12 | 0.00% | 지연 발생 |

#### MySQL
| 시나리오 | Samples | Average (ms) | Throughput (req/sec) | Error % | 비고 |
|-----------|---------|--------------|----------------------|---------|-------|
| 200 × 3 (5초) | 600 | 79.67 | 118.86 | 0.00% | MongoDB보다 느림 |
| 1000 × 3 (10초) | 3000 | 1223.34 | 208.71 | 0.00% | 지연 심화 |
| 10,000 × 3 (60초) | 30,000 | 24957.10 | 176.92 | 11.69% | 부하로 에러율 급증 |

### 2.2. 채팅방 입장 (읽기, 메시지 1000개)

#### MongoDB (인덱스 적용)
| 시나리오 | Samples | Average (ms) | Throughput (req/sec) | Error % | 비고 |
|-----------|---------|--------------|----------------------|---------|-------|
| 200 × 2 (5초) | 400 | 36.32 | 79.16 | 0.00% | 안정적 처리 |
| 1000 × 2 (10초) | 2000 | 895.63 | 161.84 | 0.00% | 지연 감소 |
| 10,000 × 2 (100초) | 20,000 | 9355.23 | 157.84 | 0.00% | 부하로 성능 저하 |

#### MySQL
| 시나리오 | Samples | Average (ms) | Throughput (req/sec) | Error % | 비고 |
|-----------|---------|--------------|----------------------|---------|-------|
| 200 × 2 (5초) | 400 | 85.86 | 69.61 | 0.00% | MongoDB보다 느림 |
| 1000 × 2 (10초) | 2000 | 98.36 | 198.22 | 0.00% | 지연 시작 |
| 10,000 × 2 (100초) | 20,000 | 4090.36 | 166.61 | 0.00% | 부하로 성능 저하 |

---

## 3. 성능 비교 (MongoDB vs MySQL)

### 3.1. 쓰기 성능 (채팅 보내기)
MongoDB가 모든 규모에서 MySQL보다 우수한 성능을 보이며, 특히 중간 규모에서 차이가 극대화됨.

### 3.2. 읽기 성능 (채팅방 입장, 메시지 1000개)
소규모에서는 MongoDB가 MySQL보다 빠르지만, 사용자가 증가할수록 MySQL이 우세한 성능을 보임.

---

## 4. 병목 지점 및 개선 제안

**MongoDB:**
- **쓰기**: 대규모에서 성능 저하 발생 (6059.38ms), 그러나 MySQL보다 나은 수준.
- **읽기**: 중간 규모에서 지연 증가 (895.63ms), 10,000명에서 심각한 성능 저하 (9355.23ms).

**MySQL:**
- **쓰기**: 소규모에서도 느리며, 대규모에서 성능이 급격히 악화됨 (24957.10ms, 에러율 11.69%).
- **읽기**: 중간~대규모에서 MongoDB보다 우수한 성능을 보임.

---

## 5. 결론

- **쓰기**: MySQL은 대규모 환경에서 약12%의 에러율을 보이는 반면, 속도또한 MongoDB가 모든 규모에서 MySQL 보다 월등한 성능을 보임.
- **읽기**: 소규모에서는 MongoDB가 빠르지만, 중간~대규모에서는 MySQL이 더 나은 성능을 보임.
- 
## 6. 향후 계획
- 현재 쓰기 속도는 MongoDB가 NySQL보다 속도도 빠르고 안정적이고 (MySQL은 대규모 환경에서 에러율이 약 12%)
- 읽기속도도 소규모에서는 MongoDB가 MySQL보다 더 빠름.
- 따라서 MongoDB로 유지하고 채팅방 입장시에 최근 채팅 10개를 보여주는식으로 성능 보완을 하는 방향으로 개선하면 좋을거같음