# 이미지 저장 방식 비교 분석 

이미지를 S3에 저장하는 방식은 어떤 것이 있으며 어떤 전략을 선택하는 것이 가장 합리적일까?
각각의 특징과 장단점을 비교하며 현재 상황에 어떤 전략이 가장 적합할지 분석해 보도록 하자.

* [업로드 방식 비교 분석](#업로드-방식-비교-분석)
* [현재 프로젝트 상황](#현재-프로젝트-상황)
* [각 방식이 프로젝트에 미치는 부정적 영향](#각-방식이-프로젝트에-미치는-영향)
* [결론](#결론)

## 업로드 방식 비교 분석
### 1. MultiPart
#### 장점
    - 대용량 파일도 안정적으로 업로드 가능
    - 진행 상황 추적 용이
    - 네트워크 문제 발생 시 실패한 부분에 대해서만 재시도 하면 됨
#### 단점
    - 용량이 작은 파일이 타겟일 경우 스코프가 너무 클 듯
    - 서버 리소스를 많이 사용함
### 2. Stream
#### 장점
    - 실시간 데이터 처리 가능
    - 구현 단순
#### 단점
    - 네트워크 장애 시 복구 불가능 → 처음부터 시도해야 함
    - 대용량 파일 처리에는 적합하지 않을 수 있음
    - 진행 상황 추적 어려움
### 3. PreSignedUrl
#### 장점
        - 서버 부담이 적음 → 클라이언트가 S3와 직접 통신하므로
        - 사용자 경험(속도)이 좋음
        - 보안성이 좋음 → 설정한 시간 동안만 사용자가 S3에 해당 URL로 접근이 가능하도록, 시간 후에는 접근이 안됨!
#### 단점
        - 진행 상황 추적 어려움
        - 용량이 크면 안정성 떨어짐

## 현재 프로젝트 상황

    1. 현재 프로젝트는 이미지 하나 하나의 용량이 크지 않다. (최대 30MB, 평균 10MB)
    2. 하지만 한 번에 여러 개의 이미지를 업로드 할 수는 있는 상황이다.(최대 5개이긴 하나, 확장의 가능성이 있다)
    3. 이미지의 자원이 중요하기에 이미지가 반드시 잘 보존되어 저장 되어야 한다!

현재 프로젝트에서의 중점은 위와 같다.<br>
그럼, 현재 프로젝트의 상황에 각 방식이 어떤 영향을 미치는지 알아보도록 하겠다.


## 각 방식이 프로젝트에 미치는 영향

### 1.MultiPart
    - 대용량 파일(1G내외)을 다룰 일이 전혀(Never!)없다.
    - 한 번에 서버에서 S3에 요청을 보내기에 서버의 부담이 증가한다.
### 2. Stream
    - 네트워크 장애 시에 복구가 불가능한데, 현재 프로젝트에서는 이미지를 다루는 것이 매우 중요하다.
### 3. PreSignedUrl
    - S3로의 접근 경로를 사용자에게 제공해야 한다.

## 결론

PreSignedUrl 방식을 채택하는 것이 현재 상황에 가장 적합한 것 같다.<br>
PreSignedUrl 방식을 사용하게 되면,
1. 사용자가 P2P처럼 S3와 직접 통신하므로 분산 처리 효과를 기대할 수 있고, 결과적으로 서버의 부담이 적어질 수 있다.
2. 이미지 첨부 버튼을 눌렀을 때 API를 호출하도록 설계하여 포스팅 작성 중 업로드가 백그라운드에서 진행되는 것을 기대한다. 
→ 최종 포스팅 등록 시 이미지 업로드를 위해 대기하는 시간이 줄어들고, 결과적으로 사용자 경험(속도)이 개선되는 것을 기대할 수 있다.
3. 스케줄러로 고아 객체를  관리해야 하지만, 사용자 경험 개선을 위해 감수할 만 하다고 생각한다.