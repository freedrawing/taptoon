# 배포 전략 선택 및 전환 과정

## 1. 초기 환경 구성 및 배포 방식

### 1.1 초기 환경 구성 (Docker 단일 컨테이너 기반)

- 프로젝트 초기에는 **EC2 단일 인스턴스**에서 단순하게 `docker run` 명령어를 통해 컨테이너를 
실행하는 방식으로 배포를 진행.
- 환경 변수 및 설정 파일은 EC2 내부에 직접 저장하여 참조하는 방식으로 구성.
- 서비스 구성 및 배포 과정:
   1. 신규 버전 이미지를 빌드 및 푸시
   2. EC2에 SSH 접속 후 환경 설정 파일 수정
   3. 수동으로 서비스 상태 확인 후 배포 완료

### 1.2 초기 배포 방식의 한계

- **무중단 배포 불가**: 서비스 중단 후 신규 컨테이너 기동 방식
- **확장성 부족**: 단일 EC2 인스턴스에 의존
- **운영 편의성 부족**: 수동 배포 및 상태 확인 필요
- **설정 관리 비효율**: 서버 내 설정 직접 관리로 보안 및 관리 부담 증가

---

## 2. Docker Compose 기반 환경 개선 

### 2.1 Docker Compose 도입 배경

- 서비스 구성 및 배포 절차 표준화 필요성 증가
- 단일 애플리케이션뿐만 아니라, 로그 수집기, 모니터링 에이전트 등 추가 구성 필요성 대비
- 서비스별 환경 구성 파일 분리 및 재사용 필요

### 2.2 Docker Compose 적용 내용

- **EC2 2대 구성 및 로드밸런서(ALB) 도입**으로 기본적인 HA 구성
- Docker Compose를 통해 **컨테이너 기동, 네트워크 구성, 볼륨 마운트 등 관리 표준화**
- GitHub Actions와 연동해, 빌드 및 배포 자동화 구성
- 서비스 설정(application-deploy.yaml)은 **gitSecrets**에서 배포 시점에 주입하는 방식으로 변경
- Redis는 AWS ElasticCache로 구성하여, 서비스 컨테이너 외부에서 관리

### 2.3 개선 효과

- 서비스 구성 및 배포 절차 표준화
- 환경 설정 파일 외부 관리로 보안성 및 관리 효율성 강화
- 로드밸런서를 통한 트래픽 분산 및 기본 장애 대응 가능
- Docker Compose 기반으로 **서비스 추가 및 환경 확장 용이**

---

## 3. AWS ECS 전환 계획 (2차 개선)

### 3.1 Docker Compose 환경의 한계

- EC2 인스턴스 상태 및 컨테이너 장애 감지 및 복구 자동화 미흡
- 서비스 상태 모니터링 및 로깅 체계 부족
- 트래픽 증가 시 컨테이너 수동 증설 필요
- 무중단 배포 시, 서비스별 대상 그룹 교체 등 추가 운영 절차 필요

### 3.2 ECS 전환 근거

| 구분                    | Docker Compose                     | AWS ECS (Fargate)                 |
|---------------------|--------------------------------|---------------------------------|
| 구성 복잡도              | 낮음 (로컬 수준)                      | 초기 구성 난이도 다소 높음            |
| 서비스 복구              | 수동 재시작                           | 서비스 상태 모니터링 및 자동 복구   |
| 무중단 배포              | ALB 대상 그룹 교체 필요             | 기본 지원 (서비스 업데이트 전략)  |
| Auto Scaling      | EC2 Auto Scaling 필요          | 서비스 단위 Auto Scaling 기본 지원 |
| 설정 관리                | gitSecrets에서 직접 로드           | Secrets Manager 연동 가능       |
| 모니터링                  | docker logs 수동 확인           | CloudWatch Logs 기본 연동      |
| 운영 효율성              | 컨테이너 관리 수작업 다수            | 컨테이너 상태 및 이벤트 자동 관리  |

### 3.3 ECS 전환 시 기대 효과

- **서비스 상태 모니터링 및 장애 자동 복구로 안정성 강화**
- **무중단 배포 및 Canary 배포 등 다양한 배포 전략 지원**
- **서비스별 Auto Scaling 정책 적용으로 트래픽 대응력 강화**
- **CloudWatch 연동으로 서비스 메트릭 및 로그 모니터링 강화**
- **Secrets Manager 및 IAM Role을 통한 보안 강화**
- **Task Definition 기반 서비스 정의로 서비스 구성 표준화**

---

## 4. 향후 EKS 도입 검토 (중장기 개선)

### 4.1 EKS 도입 배경 및 필요성

- 장기적으로 **서비스가 다수로 확대**되거나, **마이크로서비스 아키텍처(MSA)**로 전환할 가능성 대비
- 서비스 간 복잡한 연동 관리 및 서비스 Mesh 도입 필요성 증가 예상
- 워크로드 유형별로 **Node Group 구성 최적화** 필요
- 서비스별 독립적 배포 및 스케일링 정책 세분화 필요
- 장기적으로 GitOps 기반 **CI/CD 파이프라인** 구축 가능성 대비

### 4.2 EKS 도입 시 기대 효과

- **서비스별 독립적 배포 및 운영 환경 구성 가능**
- **Pod 간 네트워크 정책, 서비스 Mesh 구성 용이**
- **Helm Chart, ArgoCD 등과 연계한 배포 자동화 고도화**
- **워크로드 특성별 최적화된 Node Group 구성 가능**
- **Cluster Autoscaler 및 Horizontal Pod Autoscaler로 유연한 리소스 관리**

---

## 5. 단계별 배포 전략 요약

| 단계                          | 배포 방식                              | 주요 특징                                         |
|---------------------|--------------------------------|----------------------------------|
| 초기                          | Docker 단일 컨테이너          | 수동 배포, 단일 서버 운영                         |
| 1차 개선                  | Docker Compose            | 서비스 구성 표준화, ALB 연동, 기본 HA 구성 |
| 2차 개선 (예정)       | AWS ECS (Fargate)      | 서비스 상태 모니터링, 무중단 배포, Auto Scaling |
| 중장기 개선 (검토) | AWS EKS                         | MSA 지원, 서비스 Mesh 구성, GitOps 적용 |

---

## 6. 무중단 배포 및 Auto Scaling 운영

### 무중단 배포

- ECS 서비스 업데이트 시, **ALB 대상 그룹 교체 방식** 또는 **Rolling Update 방식**으로 무중단 배포 적용
- 배포 단계:
   1. 신규 Task 정의 및 서비스 업데이트
   2. 신규 컨테이너 기동 및 헬스체크 성공 확인
   3. 기존 컨테이너 종료 및 정리

### Auto Scaling

- ECS 서비스 단위로 **Auto Scaling 정책 적용**
   - CPU 사용률 기준 자동 확장
   - ALB Request Count 기준 확장 정책 추가 검토
- 필요 시, 서비스 별로 다른 Auto Scaling 정책 적용 가능

---

## 7. 최종 정리

- **현재 운영 환경**: Docker Compose 기반 2대 EC2 + ALB 구성
- **단기 목표**: AWS ECS 전환 및 서비스 상태 모니터링, 자동 복구, 무중단 배포 및 Auto Scaling 적용
- **중장기 목표**: 서비스 확장 및 MSA 전환 시, AWS EKS 도입 검토

---

## 8. 추가 참고

- ECS 전환 후 GitHub Actions 배포 파이프라인 구성 예시는 필요 시 별도 제공 가능
- AWS CDK, Terraform 등을 활용한 인프라 코드(IaC) 전환도 장기 검토 가능

